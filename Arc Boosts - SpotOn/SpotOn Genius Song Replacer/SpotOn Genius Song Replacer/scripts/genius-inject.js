!function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(t){return e[t]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([,,function(e,t,r){e.exports=r(3)},function(){function e(e){return Object.keys(e).map((function(t){return t+"="+encodeURIComponent(e[t])})).join("&")}function t(t,o,a,i,l){var c,s,u,d,f=!1,p=function(e){var t,r,o=new Set,a=new Set;o.add(e.title),o.add(e.title.replace(/ *\([^)]*\) */g,"")),a.add(e.artist_display_name);var i=e.artist_display_name.split("&");try{for(var l,c=n(i),s=c.next();!s.done;s=c.next())l=s.value,a.add(l.trim())}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}return{title:o,artists:a}}(a);try{for(var y,m,v=n(p.artists),h=v.next();!h.done&&(y=h.value,!f);h=v.next()){m=function(n){if(f)return"break";var a={q:n+" "+y,type:"track"},c=new XMLHttpRequest;c.open("GET","https://api.spotify.com/v1/search?"+e(a)),chrome.runtime.sendMessage({message:"getSpotifyToken",clientId:t,clientSecret:o},(function(e){f||(c.setRequestHeader("Authorization",e.token_type+" "+e.access_token),c.send(),console.debug(a.q))})),c.onreadystatechange=function(){if(4==this.readyState&&200==this.status&&!f){var e=JSON.parse(this.responseText);try{r(i,e.tracks.items[0].id,l),f=!0}catch(e){console.log("No tracks in Spotify response, received:"),console.log(this.responseText)}}}};try{for(var b=(u=void 0,n(p.title)),g=b.next();!g.done;g=b.next()){if("break"===m(g.value))break}}catch(e){u={error:e}}finally{try{g&&!g.done&&(d=b.return)&&d.call(b)}finally{if(u)throw u.error}}}}catch(e){c={error:e}}finally{try{h&&!h.done&&(s=v.return)&&s.call(v)}finally{if(c)throw c.error}}}function r(e,t,r){var n=document.createElement("iframe");n.style.height="80px",n.style.width="calc(100% - 40px)",n.style.marginLeft="20px",n.style.border="2px solid black",n.style.boxShadow="0px 0px 21px 2px rgba(0,0,0,0.7)",n.src="https://open.spotify.com/embed/track/"+t,n.setAttribute("allow","encrypted-media"),n.setAttribute("allowtransparency","true"),e.appendChild(n),e.style.display="block",r?(e.style.width="70%",e.style.marginLeft="15%"):e.style.width="100%"}var n=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};document.addEventListener("readystatechange",(function(e){var r=e.target;"complete"===(null==r?void 0:r.readyState)&&chrome.storage.local.get("credentials",(function(e){try{var r=e.credentials;!function(e,r){var n=!1,o=document.getElementsByClassName("apple_music_player_iframe_wrapper")[0];if(null==o&&(o=document.getElementsByClassName("AppleMusicPlayer__IframeWrapper-uavgzr-1")[0],n=!0),null!=o)for(var a=function(a){var i=o.childNodes[a];if("IFRAME"==i.nodeName){var l=setInterval((function(){if(null!=i.contentDocument){clearInterval(l);var a=i.contentDocument.querySelector("apple-music-player").getAttribute("preview_track");if(null!=a){var c=JSON.parse(a);t(e,r,c,o,n),o.removeChild(i)}}}),200);return"break"}},i=0;i<o.childNodes.length&&"break"!==a(i);i++);}(r.client_id,r.client_secret)}catch(e){}}))}))}]);